# 文件管理

项目中集成了简单的文件管理模块，使用`FileHandler`作为底层实现接口，`FileService`作为使用类。开发者可以通过实现`FileHandler`来完成特殊的文件管理方式。

## 使用

在上传或是下载文件时，可以使用`FileService`来完成。

```java
    @RestController
    @RequestMapping("/file")
    @Api(tags = "文件管理")
    public class FileController {

        @Autowired
        private FileService fileService;

        @PostMapping
        @Operation(summary = "上传文件")
        public BaseResult<?> uploadFile(MultipartFile[] files) {
            return fileService.uploadFile(FileCart.TEST, SecurityUtils.getUsername(), files);
        }

        @GetMapping
        @Operation(summary = "下载文件")
        public BaseResult<?> downloadFile(
                @RequestParam String fileName,
                HttpServletResponse response) {
            return fileService.downloadFile(response, FileCart.TEST, SecurityUtils.getUsername(), fileName);
        }

        @GetMapping("/list")
        @Operation(summary = "文件列表")
        public BaseResult<IPage<FileInfo>> getFileList(FileQuery fileQuery) {
            return fileService.getFileList(FileCart.TEST, SecurityUtils.getUsername(), fileQuery);
        }

        @DeleteMapping
        @Operation(summary = "删除文件")
        public BaseResult<?> deleteFile(@RequestParam String filename) {
            return fileService.deleteFile(FileCart.TEST, SecurityUtils.getUsername(), filename);
        }
    }
```

## `FileCart`说明

`FileCart`作为文件域的标识，本质上也是路径前缀，封装成枚举类的目的是规范路径，避免书写错误。

## 实现`FileService`

`FileService`接口主要是对文件上传、下载与路径管理。开发者自定义`FileService`时只需要实现其方法，并使用`Component`注解来注入Bean池即可。

```java
public interface FileHandler {

    /**
     * 获取本地文件夹对象
     *
     * @param fileCart 文件域
     * @param type     子目录
     * @return 文件夹对象
     */
    File getLocalFile(FileCart fileCart, String type);

    /**
     * 获取外网可访问的文件地址
     *
     * @param fileCart 文件域
     * @param type     文件子路径；可为空
     * @param fileName 文件名
     * @return 文件地址
     */
    String getAccessiblePath(FileCart fileCart, String type, String fileName);

    /**
     * 获取文件列表
     *
     * @param query    文件查询条件
     * @param fileCart 文件域
     * @param type     文件自目录；可为空
     * @return 文件列表信息
     */
    BaseResult<IPage<FileInfo>> getFileList(FileCart fileCart, String type, FileQuery query);

    /**
     * 上传文件
     *
     * @param fileCart 文件域
     * @param type     文件子路径；可为空
     * @param files    目标文件组
     * @return 是否上传成功
     */
    BaseResult<?> uploadFile(FileCart fileCart, String type, MultipartFile... files);

    /**
     * 下载文件
     *
     * @param response 服务器响应对象
     * @param fileCart 目标文件所在文件域
     * @param type     文件子目录；可为空
     * @param fileName 目标文件名
     * @return 下载结果
     */
    BaseResult<?> downloadFile(HttpServletResponse response, FileCart fileCart, String type, String fileName);

    /**
     * 删除文件
     *
     * @param fileCart 目标文件所在文件域
     * @param type     文件子目录；可为空
     * @param fileName 目标文件名
     * @return 删除结果
     */
    BaseResult<?> deleteFile(FileCart fileCart, String type, String fileName);
}
```