# 定时任务

本项目中的定时任务由`SchedulingService`统一维护，开发者可以通过以下注解标记定时任务：
- `ScheduledFixedDelay`延迟定时任务
- `ScheduledCron`表达式定期任务
- `ScheduledFixedRate`间隔定时任务

使用注解后还需要实现`Runnable`接口才可以注册添加到`SchedulingService`。
如果需要运行时自动注册到定时任务中，可以添加`@Component`注解添加到Bean池中。

## 举例

以下方式实现的定时任务需要通过`SchedulingService.insert(Runnable runnable)`方法手动添加到任务表中。
```java
@ScheduledFixedRate(value = "name", interval = 5000)
public class DemoSchedule implements Runnable {

    @Override
    public void run() {
        // TODO: 任务内容
    }
}
```

------

以下方式实现的定时任务会自动添加到任务表中。
```java
@Component
@ScheduledFixedRate(value = "name", interval = 5000)
public class DemoSchedule implements Runnable {

    @Override
    public void run() {
        // TODO: 任务内容
    }
}
```

------

注意，任务表中不允许出现同名任务，否则会添加不进去。可以在日志中发现未能添加的任务。

## 使用

```java
@Autowired
private SchedulingService schedulingService;
private Runnable task = new DemoRunnable();

    // 使用注解名称或默认名称添加任务
    schedulingService.insert(task);
    // 使用动态名称添加任务
    schedulingService.insert("name", task);
    // 取消任务
    schedulingService.cancel("name");
```

## 配置
在`application.yml`中通过以下配置限制任务表。被限制的任务是无法自动或手动添加到任务表中的。
```yaml
station:
  # 定时任务配置
  schedule:
    # 允许的定时任务列表。格式为yml的列表格式
    allowed:
      - name1
      - name2
    # 屏蔽的定时任务列表
    blocked:
      - name3
      - name4
```